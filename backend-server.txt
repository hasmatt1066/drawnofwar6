
> @drawn-of-war/backend@0.1.0 dev /mnt/c/Users/mhast/Desktop/drawnofwar6/backend
> LD_LIBRARY_PATH=../node_modules/.pnpm/@img+sharp-libvips-linux-x64@1.2.3/node_modules/@img/sharp-libvips-linux-x64/lib:$LD_LIBRARY_PATH node node_modules/tsx/dist/cli.mjs watch --clear-screen=false src/index.ts

[Claude Vision] Service initialized
[Claude Vision] Model: claude-3-5-sonnet-20241022
[Animation Library] Loaded 55 animations
[Animation Library] Categories: { idle: 5, locomotion: 12, combat: 15, abilities: 15, reactions: 8 }
[Animation Mapper] Service initialized
[Attribute Extractor] Service initialized
[Style Validator] Service initialized
[Style Validator] Pass threshold: 60%
[Startup] Validating Claude API configuration...
[Claude Config] Configuration loaded successfully
[Claude Config] Model: claude-3-5-sonnet-20241022
[Claude Config] API URL: https://api.anthropic.com/v1
[Claude Config] Max Tokens: 1024
[Claude Config] Timeout: 30000ms
[Startup] Initializing Firebase Admin SDK...
{"timestamp":"2025-10-20T03:41:35.620Z","level":"info","type":"queue_manager_initialized","queueName":"generation-queue","redisHost":"localhost","redisPort":6379,"redisDb":0}
{"timestamp":"2025-10-20T03:41:35.621Z","level":"info","type":"worker_started","queueName":"generation-queue","concurrency":5,"redisHost":"localhost","redisPort":6379}
[Queue Service] Initialized successfully
[Firebase] Initializing with emulator configuration
[Firebase] Using Firestore emulator at localhost:8080
[Firebase] Using Storage emulator at localhost:9199
[Firebase] Initialized successfully
[Startup] Firebase connection check failed or timed out - creature library features may not work
[Startup] Make sure Firebase emulator is running if USE_FIREBASE_EMULATOR=true
[Startup] Initializing creature sprite manager...
[CreatureSpriteManager] Loaded 0 cached sprites
[Startup] Creature sprite manager initialized
[Startup] Initializing Socket.IO server...
[Socket.IO] Initialized with namespaces: /combat, /deployment
[Startup] Initializing combat socket handler...
[Startup] Initializing deployment socket handler...
[Deployment Socket] Initialized
[Server] Drawn of War backend running
[Server] URL: http://localhost:3001
[Server] WebSocket: ws://localhost:3001
[Server] Environment: development
[Server] Health check: http://localhost:3001/health
[Firebase] Connection check passed
[CreatureSpriteManager] Generating sprite for p1-warrior (Warrior)
[CreatureSpriteManager] Generating sprite for p1-archer (Archer)
[CreatureSpriteManager] Generating sprite for p1-mage (Mage)
[CreatureSpriteManager] Generating sprite for p1-tank (Tank)
[CreatureSpriteManager] Generating sprite for p1-rogue (Rogue)
[CreatureSpriteManager] Generating sprite for p1-cleric (Cleric)
[CreatureSpriteManager] Generating sprite for p1-paladin (Paladin)
[CreatureSpriteManager] Generating sprite for p1-ranger (Ranger)
[CreatureSpriteManager] Generating sprite for p2-warrior (Warrior)
[CreatureSpriteManager] Generating sprite for p2-archer (Archer)
[CreatureSpriteManager] Generating sprite for p2-mage (Mage)
[CreatureSpriteManager] Generating sprite for p2-tank (Tank)
[CreatureSpriteManager] Generating sprite for p2-rogue (Rogue)
[CreatureSpriteManager] Generating sprite for p2-cleric (Cleric)
[CreatureSpriteManager] Generating sprite for p2-paladin (Paladin)
[CreatureSpriteManager] Generating sprite for p2-ranger (Ranger)
[CreatureSpriteManager] Failed to generate sprite for p1-warrior: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p1-warrior
[CreatureSpriteManager] Failed to generate sprite for p1-archer: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p1-archer
[CreatureSpriteManager] Failed to generate sprite for p1-mage: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p1-mage
[CreatureSpriteManager] Failed to generate sprite for p1-tank: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p1-tank
[CreatureSpriteManager] Failed to generate sprite for p1-rogue: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p1-rogue
[CreatureSpriteManager] Failed to generate sprite for p1-cleric: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p1-cleric
[CreatureSpriteManager] Failed to generate sprite for p1-paladin: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p1-paladin
[CreatureSpriteManager] Failed to generate sprite for p1-ranger: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p1-ranger
[CreatureSpriteManager] Failed to generate sprite for p2-warrior: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p2-warrior
[CreatureSpriteManager] Failed to generate sprite for p2-archer: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p2-archer
[CreatureSpriteManager] Failed to generate sprite for p2-mage: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p2-mage
[CreatureSpriteManager] Failed to generate sprite for p2-tank: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p2-tank
[CreatureSpriteManager] Failed to generate sprite for p2-rogue: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p2-rogue
[CreatureSpriteManager] Failed to generate sprite for p2-cleric: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p2-cleric
[CreatureSpriteManager] Failed to generate sprite for p2-paladin: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p2-paladin
[CreatureSpriteManager] Failed to generate sprite for p2-ranger: PixelLabError: View must be one of: low top-down, high top-down, side
    at Function.validateView (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:232:13)
    at Function.validateGenerationRequest (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/request-validator.ts:134:12)
    at SpriteGenerator.submitGeneration (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/pixellab/sprite-generator.ts:53:22)
    at CreatureSpriteManager.generateSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:136:44)
    at CreatureSpriteManager.getSprite (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/services/creature-sprite-manager.ts:94:35)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:98:21)
    at Array.map (<anonymous>)
    at <anonymous> (/mnt/c/Users/mhast/Desktop/drawnofwar6/backend/src/api/routes/creature-sprites.routes.ts:97:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  type: 'invalid_request',
  statusCode: undefined,
  retryable: false,
  originalError: undefined,
  fieldErrors: undefined
}
[CreatureSpriteManager] Using placeholder for p2-ranger
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: hmx1HytKHypeucO_AAAC
[Deployment Socket] Client connected: htpyhoqgYsnABcGJAAAD
[Deployment Socket] player1 joining match scroll-test-1760931980474
[Deployment Socket] Match scroll-test-1760931980474 not found, creating new match...
[Deployment Socket] Match scroll-test-1760931980474 created successfully
[Deployment Socket] player1 joined match scroll-test-1760931980474
[Deployment Socket] player2 joining match scroll-test-1760931980474
[Deployment Socket] player2 joined match scroll-test-1760931980474
[Deployment Socket] player1 disconnected from match scroll-test-1760931980474
[Deployment Socket] Client disconnected: htpyhoqgYsnABcGJAAAD
[Deployment Socket] player2 disconnected from match scroll-test-1760931980474
[Deployment Socket] Client disconnected: hmx1HytKHypeucO_AAAC
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: 8qWJT-2zwrM7daAnAAAF
[Deployment Socket] player1 joining match test123
[Deployment Socket] Match test123 not found, creating new match...
[Deployment Socket] Match test123 created successfully
[Deployment Socket] player1 joined match test123
[Deployment Socket] player1 placed creature at (2, 3)
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: ZzfWt4DXLiGG0j2WAAAH
[Deployment Socket] player2 joining match test123
[Deployment Socket] player2 joined match test123
[Deployment Socket] player2 placed creature at (10, 3)
[Match test123] Countdown cancelled
[Match test123] Countdown started: 30 seconds
[Deployment Socket] player1 marked ready in match test123 (1 creatures)
[Match test123] Countdown cancelled
[Match test123] Both players locked - deployment complete
[Match test123] Converting to deployment state:
  Player 1 placements: 1
  Player 2 placements: 1
[CombatEngine] initializeFromDeployment - Input: { matchId: 'test123', player1Placements: 1, player2Placements: 1 }
[CombatEngine] Created player1 unit: {
  unitId: 'player1_p1-warrior_1760932290634',
  creatureId: 'p1-warrior',
  position: { q: 2, r: 3 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-tank_1760932290634',
  creatureId: 'p2-tank',
  position: { q: 10, r: 3 }
}
[CombatEngine] initializeFromDeployment - Units created: { totalUnits: 2, player1Units: 1, player2Units: 1 }
[CombatEngine] start() - Starting combat simulation: {
  matchId: 'test123',
  totalUnits: 2,
  player1Units: 1,
  player2Units: 1,
  tickRate: 60
}
[Deployment Socket] player2 marked ready in match test123 (1 creatures)
[Combat Socket] ✓ Started broadcasting for match test123, 0 clients in room combat:test123
[Match test123] Combat socket broadcasting started
[Match test123] Combat started successfully
[CombatEngine] tick() - Tick 0 state: { totalUnits: 2, aliveUnits: 2, player1Alive: 1, player2Alive: 1 }
[Combat Socket] Client connected: y8GQtmlZLS2xIXyNAAAI
[Combat Socket] Client connected: 2XL_f7NVWBUNqTJjAAAJ
[Combat Socket] Client y8GQtmlZLS2xIXyNAAAI requesting to join match test123
[Combat Socket] ✓ Client y8GQtmlZLS2xIXyNAAAI joined room combat:test123
[Combat Socket] Sending current combat state (tick 2) to y8GQtmlZLS2xIXyNAAAI
[Combat Socket] Emitting combat:joined to y8GQtmlZLS2xIXyNAAAI
[Combat Socket] Client 2XL_f7NVWBUNqTJjAAAJ requesting to join match test123
[Combat Socket] ✓ Client 2XL_f7NVWBUNqTJjAAAJ joined room combat:test123
[Combat Socket] Sending current combat state (tick 2) to 2XL_f7NVWBUNqTJjAAAJ
[Combat Socket] Emitting combat:joined to 2XL_f7NVWBUNqTJjAAAJ
[Combat Socket] Broadcasting state tick 61 to 2 clients in room combat:test123
[Combat Socket] Broadcasting state tick 122 to 2 clients in room combat:test123
[Combat Socket] Broadcasting state tick 184 to 2 clients in room combat:test123
[Combat Socket] Broadcasting state tick 246 to 2 clients in room combat:test123
[Combat Socket] Broadcasting state tick 308 to 2 clients in room combat:test123
[Combat Socket] Broadcasting state tick 370 to 2 clients in room combat:test123
[Combat Socket] Broadcasting state tick 432 to 2 clients in room combat:test123
[Combat Socket] Broadcasting state tick 494 to 2 clients in room combat:test123
[Combat Socket] Broadcasting state tick 556 to 2 clients in room combat:test123
[CombatEngine] checkVictoryCondition - Victory condition met: { tick: 557, player1Alive: 1, player2Alive: 0 }
[CombatEngine] endCombat - Combat ending: {
  matchId: 'test123',
  reason: 'elimination',
  winner: 'player1',
  tick: 557,
  player1Alive: 1,
  player2Alive: 0,
  totalUnits: 2
}
[Match test123] Combat completed - Winner: player1
[Combat Socket] No state found, stopping broadcast for match test123
[Combat Socket] Stopped broadcasting for match test123
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: Jsrknop0OEskswEWAAAL
[Deployment Socket] player1 joining match debug-1760932487599
[Deployment Socket] Match debug-1760932487599 not found, creating new match...
[Deployment Socket] Match debug-1760932487599 created successfully
[Deployment Socket] player1 joined match debug-1760932487599
[Deployment Socket] player1 disconnected from match debug-1760932487599
[Deployment Socket] Client disconnected: Jsrknop0OEskswEWAAAL
[Deployment Socket] player2 disconnected from match test123
[Deployment Socket] Client disconnected: ZzfWt4DXLiGG0j2WAAAH
[Combat Socket] Client disconnected: 2XL_f7NVWBUNqTJjAAAJ
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: fSgIAvgcPnwJyiAPAAAN
[Deployment Socket] player2 joining match test123
[Deployment Socket] player2 joined match test123
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: GhYorGitdA5fSAWRAAAP
[Deployment Socket] player1 joining match test123
[Deployment Socket] player1 joined match test123
[Deployment Socket] player1 disconnected from match test123
[Deployment Socket] Client disconnected: GhYorGitdA5fSAWRAAAP
[Deployment Socket] player1 disconnected from match test123
[Deployment Socket] Client disconnected: 8qWJT-2zwrM7daAnAAAF
[Combat Socket] Client disconnected: y8GQtmlZLS2xIXyNAAAI
[Deployment Socket] player2 disconnected from match test123
[Deployment Socket] Client disconnected: fSgIAvgcPnwJyiAPAAAN
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[Deployment Socket] Client connected: IdvGTQ6fZPxF6MptAAAR
[Deployment Socket] player1 joining match 094b6479-34ce-430f-9234-fb3c0626d2b7
[Deployment Socket] Match 094b6479-34ce-430f-9234-fb3c0626d2b7 not found, creating new match...
[Deployment Socket] Match 094b6479-34ce-430f-9234-fb3c0626d2b7 created successfully
[Deployment Socket] player1 joined match 094b6479-34ce-430f-9234-fb3c0626d2b7
[Deployment Socket] player1 disconnected from match 094b6479-34ce-430f-9234-fb3c0626d2b7
[Deployment Socket] Client disconnected: IdvGTQ6fZPxF6MptAAAR
[Generate Enhanced] Received text request
[Generate Enhanced] Text description: a gaggle of frogs ...
[Generate Enhanced] Submitting job to queue (text)
[Generate Enhanced] Job 24 submitted in 3ms
{"timestamp":"2025-10-20T03:59:00.885Z","level":"info","type":"queue_state_change","jobId":"24","fromState":"waiting","toState":"active","metadata":{"jobName":"generation","userId":"anonymous"}}
[Generation Processor] Processing job 24 (text)
[Generation Processor] Text-only path (PixelLab → Claude Vision)
[Generation Processor] Step 1: Generating sprite from text description...
[Generation Processor] PixelLab request: {
  description: 'a gaggle of frogs ',
  size: 64,
  detail: 'medium detail',
  shading: 'basic shading',
  outline: 'single color black outline',
  view: 'side',
  textGuidanceScale: 7.5,
  noBackground: true
}
[Generation Processor] PixelLab sprite generated, cost: 0 USD
[Generation Processor] Step 2: Analyzing generated sprite with Claude Vision...
[Claude Vision] Starting creature analysis...
[Claude Vision] Text context: "a gaggle of frogs "
The model 'claude-3-5-sonnet-20241022' is deprecated and will reach end-of-life on October 22, 2025
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.
[Claude Vision] Received response from API
[Claude Vision] Cost: $0.009480
[Claude Vision] Analysis complete
[Claude Vision] Concept: "playful frog group"
[Claude Vision] Race: amphibian, Class: support
[Claude Vision] Animations: 20
[Claude Vision] Tokens used: 1924
[Claude Vision] Duration: 4421ms
[Generation Processor] Step 3: Mapping animations from Claude analysis...
[Animation Mapper] Mapping animations...
[Animation Mapper] Claude suggested: 20 animations
[Animation Mapper] Mapped 7 from Claude suggestions
[Animation Mapper] Added 9 filler animations
[Animation Mapper] Total animations: 20
[Generation Processor] Step 4: Extracting combat attributes...
[Attribute Extractor] Extracting combat attributes...
[Attribute Extractor] Input abilities: 4
[Attribute Extractor] Found 3 unique attributes
[Attribute Extractor] 1 attributes have valid sprite animations
[Attribute Extractor] Selected 1 primary attributes:
  - Dash (ability, priority: 4, animation: dash_default)
[Attribute Extractor] Loading effect animation frames...
[Attribute Extractor] Loaded 4 frames for Dash
[Generation Processor] Step 5: Generating walk animation frames...
[Generation Processor] Walk animation generated with 4 frames, cost: 0 USD
[Generation Processor] Step 6: Generating multi-directional battlefield views (rotation-based)...
[Generation Processor] Generating E direction using rotation API...
[Generation Processor] E sprite rotated, cost: 0.0000 USD
[Generation Processor] E walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] E idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Generating NE direction using rotation API...
[Generation Processor] NE sprite rotated, cost: 0.0000 USD
[Generation Processor] NE walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] NE idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Generating SE direction using rotation API...
[Generation Processor] SE sprite rotated, cost: 0.0000 USD
[Generation Processor] SE walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] SE idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Multi-directional battlefield views generation complete (rotation-based)
[Generation Processor] Total API cost: 0.0000 USD
[Generation Processor] Job 24 completed in 167471ms
{"timestamp":"2025-10-20T04:01:48.361Z","level":"info","type":"queue_state_change","jobId":"24","fromState":"active","toState":"completed","metadata":{"jobName":"generation...[truncated]","result":"[Object truncated]"}}
[Creatures API] Saving creature from job 24 for owner demo-player1
[CreatureSaveService] Starting save for job 24, owner demo-player1
[CreatureSaveService] Retrieved generation result for job 24
[CreatureSaveService] Transformed to creature: Playful Frog Group
[CreatureSaveService] Created Firestore document with ID: yYjgBQtTpDNGuMCSnf3z
[CreatureSaveService] Uploading sprites for creature yYjgBQtTpDNGuMCSnf3z...
[CreatureSaveService] Using multi-directional battlefield views
[CreatureSaveService] Successfully uploaded all sprites for creature yYjgBQtTpDNGuMCSnf3z
[CreatureSaveService] Successfully saved creature yYjgBQtTpDNGuMCSnf3z
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FyYjgBQtTpDNGuMCSnf3z%2Fdirections%2FE-idle-0.png?alt=media
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FyYjgBQtTpDNGuMCSnf3z%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] Client connected: xjYaEh2ImFSti0CIAAAT
[Deployment Socket] player1 joining match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] Match 5445e307-0e68-4ed1-b01d-47e49caf0384 not found, creating new match...
[Deployment Socket] Match 5445e307-0e68-4ed1-b01d-47e49caf0384 created successfully
[Deployment Socket] player1 joined match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] player1 placed creature at (2, 4)
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: z_DCT3e1NDszJCvHAAAV
[Deployment Socket] player2 joining match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] player2 joined match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] player2 placed creature at (9, 4)
[Match 5445e307-0e68-4ed1-b01d-47e49caf0384] Countdown cancelled
[Match 5445e307-0e68-4ed1-b01d-47e49caf0384] Countdown started: 30 seconds
[Deployment Socket] player2 marked ready in match 5445e307-0e68-4ed1-b01d-47e49caf0384 (1 creatures)
[Match 5445e307-0e68-4ed1-b01d-47e49caf0384] Countdown cancelled
[Match 5445e307-0e68-4ed1-b01d-47e49caf0384] Both players locked - deployment complete
[Match 5445e307-0e68-4ed1-b01d-47e49caf0384] Converting to deployment state:
  Player 1 placements: 1
  Player 2 placements: 1
[CombatEngine] initializeFromDeployment - Input: {
  matchId: '5445e307-0e68-4ed1-b01d-47e49caf0384',
  player1Placements: 1,
  player2Placements: 1
}
[CombatEngine] Created player1 unit: {
  unitId: 'player1_yYjgBQtTpDNGuMCSnf3z_1760932937800',
  creatureId: 'yYjgBQtTpDNGuMCSnf3z',
  position: { q: 2, r: 4 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-tank_1760932937800',
  creatureId: 'p2-tank',
  position: { q: 9, r: 4 }
}
[CombatEngine] initializeFromDeployment - Units created: { totalUnits: 2, player1Units: 1, player2Units: 1 }
[CombatEngine] start() - Starting combat simulation: {
  matchId: '5445e307-0e68-4ed1-b01d-47e49caf0384',
  totalUnits: 2,
  player1Units: 1,
  player2Units: 1,
  tickRate: 60
}
[Deployment Socket] player1 marked ready in match 5445e307-0e68-4ed1-b01d-47e49caf0384 (1 creatures)
[Combat Socket] ✓ Started broadcasting for match 5445e307-0e68-4ed1-b01d-47e49caf0384, 0 clients in room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[Match 5445e307-0e68-4ed1-b01d-47e49caf0384] Combat socket broadcasting started
[Match 5445e307-0e68-4ed1-b01d-47e49caf0384] Combat started successfully
[CombatEngine] tick() - Tick 0 state: { totalUnits: 2, aliveUnits: 2, player1Alive: 1, player2Alive: 1 }
[Combat Socket] Client connected: I_kSIQW8J_2eO4T7AAAW
[Combat Socket] Client connected: aJGHeTx7RfaaK3XkAAAX
[Combat Socket] Client I_kSIQW8J_2eO4T7AAAW requesting to join match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] ✓ Client I_kSIQW8J_2eO4T7AAAW joined room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] Sending current combat state (tick 2) to I_kSIQW8J_2eO4T7AAAW
[Combat Socket] Emitting combat:joined to I_kSIQW8J_2eO4T7AAAW
[Combat Socket] Client aJGHeTx7RfaaK3XkAAAX requesting to join match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] ✓ Client aJGHeTx7RfaaK3XkAAAX joined room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] Sending current combat state (tick 2) to aJGHeTx7RfaaK3XkAAAX
[Combat Socket] Emitting combat:joined to aJGHeTx7RfaaK3XkAAAX
[Combat Socket] Broadcasting state tick 61 to 2 clients in room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] Broadcasting state tick 122 to 2 clients in room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] Broadcasting state tick 184 to 2 clients in room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] Broadcasting state tick 246 to 2 clients in room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] Broadcasting state tick 308 to 2 clients in room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] Broadcasting state tick 370 to 2 clients in room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] Broadcasting state tick 432 to 2 clients in room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] Broadcasting state tick 494 to 2 clients in room combat:5445e307-0e68-4ed1-b01d-47e49caf0384
[CombatEngine] checkVictoryCondition - Victory condition met: { tick: 556, player1Alive: 1, player2Alive: 0 }
[CombatEngine] endCombat - Combat ending: {
  matchId: '5445e307-0e68-4ed1-b01d-47e49caf0384',
  reason: 'elimination',
  winner: 'player1',
  tick: 556,
  player1Alive: 1,
  player2Alive: 0,
  totalUnits: 2
}
[Match 5445e307-0e68-4ed1-b01d-47e49caf0384] Combat completed - Winner: player1
[Combat Socket] No state found, stopping broadcast for match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Combat Socket] Stopped broadcasting for match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] player1 disconnected from match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] Client disconnected: xjYaEh2ImFSti0CIAAAT
[Combat Socket] Client disconnected: aJGHeTx7RfaaK3XkAAAX
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[Deployment Socket] Client connected: pQXO9NiWuts_FHsqAAAZ
[Deployment Socket] player1 joining match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] player1 joined match 5445e307-0e68-4ed1-b01d-47e49caf0384
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FyYjgBQtTpDNGuMCSnf3z%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] player1 disconnected from match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] Client disconnected: pQXO9NiWuts_FHsqAAAZ
[Deployment Socket] Client connected: TQWVbkxOBrH7WuijAAAb
[Deployment Socket] player1 joining match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] player1 joined match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] player1 disconnected from match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] Client disconnected: TQWVbkxOBrH7WuijAAAb
[Creatures API] Saving creature from job 24 for owner demo-player1
[CreatureSaveService] Starting save for job 24, owner demo-player1
[CreatureSaveService] Retrieved generation result for job 24
[CreatureSaveService] Transformed to creature: Playful Frog Group
[CreatureSaveService] Created Firestore document with ID: 9wql93Feq4YKNADdCjHR
[CreatureSaveService] Uploading sprites for creature 9wql93Feq4YKNADdCjHR...
[CreatureSaveService] Using multi-directional battlefield views
[CreatureSaveService] Successfully uploaded all sprites for creature 9wql93Feq4YKNADdCjHR
[CreatureSaveService] Successfully saved creature 9wql93Feq4YKNADdCjHR
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2F9wql93Feq4YKNADdCjHR%2Fdirections%2FE-idle-0.png?alt=media
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2F9wql93Feq4YKNADdCjHR%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] Client connected: S39gZBVVBxRYQBhHAAAd
[Deployment Socket] player1 joining match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Deployment Socket] Match 648c032e-2fe9-42cd-8154-97ca411a9ce6 not found, creating new match...
[Deployment Socket] Match 648c032e-2fe9-42cd-8154-97ca411a9ce6 created successfully
[Deployment Socket] player1 joined match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Deployment Socket] player1 placed creature at (2, 4)
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: oFNTRreernY00wUGAAAf
[Deployment Socket] player2 joining match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Deployment Socket] player2 joined match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Deployment Socket] player2 placed creature at (9, 3)
[Deployment Socket] player2 placed creature at (9, 7)
[Match 648c032e-2fe9-42cd-8154-97ca411a9ce6] Countdown cancelled
[Match 648c032e-2fe9-42cd-8154-97ca411a9ce6] Countdown started: 30 seconds
[Deployment Socket] player2 marked ready in match 648c032e-2fe9-42cd-8154-97ca411a9ce6 (2 creatures)
[Match 648c032e-2fe9-42cd-8154-97ca411a9ce6] Countdown cancelled
[Match 648c032e-2fe9-42cd-8154-97ca411a9ce6] Both players locked - deployment complete
[Match 648c032e-2fe9-42cd-8154-97ca411a9ce6] Converting to deployment state:
  Player 1 placements: 1
  Player 2 placements: 2
[CombatEngine] initializeFromDeployment - Input: {
  matchId: '648c032e-2fe9-42cd-8154-97ca411a9ce6',
  player1Placements: 1,
  player2Placements: 2
}
[CombatEngine] Created player1 unit: {
  unitId: 'player1_9wql93Feq4YKNADdCjHR_1760933290796',
  creatureId: '9wql93Feq4YKNADdCjHR',
  position: { q: 2, r: 4 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-tank_1760933290797',
  creatureId: 'p2-tank',
  position: { q: 9, r: 3 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-rogue_1760933290797',
  creatureId: 'p2-rogue',
  position: { q: 9, r: 7 }
}
[CombatEngine] initializeFromDeployment - Units created: { totalUnits: 3, player1Units: 1, player2Units: 2 }
[CombatEngine] start() - Starting combat simulation: {
  matchId: '648c032e-2fe9-42cd-8154-97ca411a9ce6',
  totalUnits: 3,
  player1Units: 1,
  player2Units: 2,
  tickRate: 60
}
[Deployment Socket] player1 marked ready in match 648c032e-2fe9-42cd-8154-97ca411a9ce6 (1 creatures)
[Combat Socket] ✓ Started broadcasting for match 648c032e-2fe9-42cd-8154-97ca411a9ce6, 0 clients in room combat:648c032e-2fe9-42cd-8154-97ca411a9ce6
[Match 648c032e-2fe9-42cd-8154-97ca411a9ce6] Combat socket broadcasting started
[Match 648c032e-2fe9-42cd-8154-97ca411a9ce6] Combat started successfully
[CombatEngine] tick() - Tick 0 state: { totalUnits: 3, aliveUnits: 3, player1Alive: 1, player2Alive: 2 }
[Combat Socket] Client connected: f7ix6lnPyfaZrjO9AAAg
[Combat Socket] Client connected: Xsx8AEtdUoJ2K0gEAAAh
[Combat Socket] Client f7ix6lnPyfaZrjO9AAAg requesting to join match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Combat Socket] ✓ Client f7ix6lnPyfaZrjO9AAAg joined room combat:648c032e-2fe9-42cd-8154-97ca411a9ce6
[Combat Socket] Sending current combat state (tick 3) to f7ix6lnPyfaZrjO9AAAg
[Combat Socket] Emitting combat:joined to f7ix6lnPyfaZrjO9AAAg
[Combat Socket] Client Xsx8AEtdUoJ2K0gEAAAh requesting to join match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Combat Socket] ✓ Client Xsx8AEtdUoJ2K0gEAAAh joined room combat:648c032e-2fe9-42cd-8154-97ca411a9ce6
[Combat Socket] Sending current combat state (tick 3) to Xsx8AEtdUoJ2K0gEAAAh
[Combat Socket] Emitting combat:joined to Xsx8AEtdUoJ2K0gEAAAh
[Combat Socket] Broadcasting state tick 61 to 2 clients in room combat:648c032e-2fe9-42cd-8154-97ca411a9ce6
[Combat Socket] Broadcasting state tick 122 to 2 clients in room combat:648c032e-2fe9-42cd-8154-97ca411a9ce6
[Combat Socket] Broadcasting state tick 183 to 2 clients in room combat:648c032e-2fe9-42cd-8154-97ca411a9ce6
[Combat Socket] Broadcasting state tick 245 to 2 clients in room combat:648c032e-2fe9-42cd-8154-97ca411a9ce6
[Combat Socket] Broadcasting state tick 306 to 2 clients in room combat:648c032e-2fe9-42cd-8154-97ca411a9ce6
[CombatEngine] checkVictoryCondition - Victory condition met: { tick: 311, player1Alive: 0, player2Alive: 2 }
[CombatEngine] endCombat - Combat ending: {
  matchId: '648c032e-2fe9-42cd-8154-97ca411a9ce6',
  reason: 'elimination',
  winner: 'player2',
  tick: 311,
  player1Alive: 0,
  player2Alive: 2,
  totalUnits: 3
}
[Match 648c032e-2fe9-42cd-8154-97ca411a9ce6] Combat completed - Winner: player2
[Combat Socket] No state found, stopping broadcast for match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Combat Socket] Stopped broadcasting for match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Deployment Socket] player1 disconnected from match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Deployment Socket] Client disconnected: S39gZBVVBxRYQBhHAAAd
[Combat Socket] Client disconnected: f7ix6lnPyfaZrjO9AAAg
[Creatures API] Saving creature from job 24 for owner demo-player1
[CreatureSaveService] Starting save for job 24, owner demo-player1
[CreatureSaveService] Retrieved generation result for job 24
[CreatureSaveService] Transformed to creature: Playful Frog Group
[CreatureSaveService] Created Firestore document with ID: jbxaJM8W5QqkiMMu5bsJ
[CreatureSaveService] Uploading sprites for creature jbxaJM8W5QqkiMMu5bsJ...
[CreatureSaveService] Using multi-directional battlefield views
[CreatureSaveService] Successfully uploaded all sprites for creature jbxaJM8W5QqkiMMu5bsJ
[CreatureSaveService] Successfully saved creature jbxaJM8W5QqkiMMu5bsJ
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FjbxaJM8W5QqkiMMu5bsJ%2Fdirections%2FE-idle-0.png?alt=media
[Generate Enhanced] Received text request
[Generate Enhanced] Text description: a giant giant chibi squirrel ...
[Generate Enhanced] Submitting job to queue (text)
[Generate Enhanced] Job 25 submitted in 2ms
{"timestamp":"2025-10-20T04:15:02.118Z","level":"info","type":"queue_state_change","jobId":"25","fromState":"waiting","toState":"active","metadata":{"jobName":"generation","userId":"anonymous"}}
[Generation Processor] Processing job 25 (text)
[Generation Processor] Text-only path (PixelLab → Claude Vision)
[Generation Processor] Step 1: Generating sprite from text description...
[Generation Processor] PixelLab request: {
  description: 'a giant giant chibi squirrel ',
  size: 64,
  detail: 'medium detail',
  shading: 'basic shading',
  outline: 'single color black outline',
  view: 'side',
  textGuidanceScale: 7.5,
  noBackground: true
}
[Generation Processor] PixelLab sprite generated, cost: 0 USD
[Generation Processor] Step 2: Analyzing generated sprite with Claude Vision...
[Claude Vision] Starting creature analysis...
[Claude Vision] Text context: "a giant giant chibi squirrel "
The model 'claude-3-5-sonnet-20241022' is deprecated and will reach end-of-life on October 22, 2025
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.
[Claude Vision] Received response from API
[Claude Vision] Cost: $0.009876
[Claude Vision] Analysis complete
[Claude Vision] Concept: "cute battle squirrel"
[Claude Vision] Race: beast, Class: rogue
[Claude Vision] Animations: 25
[Claude Vision] Tokens used: 1952
[Claude Vision] Duration: 5063ms
[Generation Processor] Step 3: Mapping animations from Claude analysis...
[Animation Mapper] Mapping animations...
[Animation Mapper] Claude suggested: 25 animations
[Animation Mapper] Mapped 14 from Claude suggestions
[Animation Mapper] Added 3 filler animations
[Animation Mapper] Total animations: 21
[Generation Processor] Step 4: Extracting combat attributes...
[Attribute Extractor] Extracting combat attributes...
[Attribute Extractor] Input abilities: 4
[Attribute Extractor] Found 4 unique attributes
[Attribute Extractor] 4 attributes have valid sprite animations
[Attribute Extractor] Selected 3 primary attributes:
  - Bite Attack (melee, priority: 7, animation: attack_melee_bite)
  - Claw Strike (melee, priority: 7, animation: attack_melee_claw)
  - Stealth (ability, priority: 5, animation: stealth)
[Attribute Extractor] Loading effect animation frames...
[Attribute Extractor] Loaded 4 frames for Stealth
[Attribute Extractor] Loaded 4 frames for Bite Attack
[Attribute Extractor] Loaded 4 frames for Claw Strike
[Generation Processor] Step 5: Generating walk animation frames...
[Generation Processor] Walk animation generated with 4 frames, cost: 0 USD
[Generation Processor] Step 6: Generating multi-directional battlefield views (rotation-based)...
[Generation Processor] Generating E direction using rotation API...
[Generation Processor] E sprite rotated, cost: 0.0000 USD
[Generation Processor] E walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] E idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Generating NE direction using rotation API...
[Generation Processor] NE sprite rotated, cost: 0.0000 USD
[Generation Processor] NE walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] NE idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Generating SE direction using rotation API...
[Generation Processor] SE sprite rotated, cost: 0.0000 USD
[Generation Processor] SE walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] SE idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Multi-directional battlefield views generation complete (rotation-based)
[Generation Processor] Total API cost: 0.0000 USD
[Generation Processor] Job 25 completed in 179466ms
{"timestamp":"2025-10-20T04:18:01.588Z","level":"info","type":"queue_state_change","jobId":"25","fromState":"active","toState":"completed","metadata":{"jobName":"generation...[truncated]","result":"[Object truncated]"}}
[Creatures API] Saving creature from job 25 for owner demo-player1
[CreatureSaveService] Starting save for job 25, owner demo-player1
[CreatureSaveService] Retrieved generation result for job 25
[CreatureSaveService] Transformed to creature: Cute Battle Squirrel
[CreatureSaveService] Created Firestore document with ID: 8xpFsBbxUm37TXh1vHE6
[CreatureSaveService] Uploading sprites for creature 8xpFsBbxUm37TXh1vHE6...
[CreatureSaveService] Using multi-directional battlefield views
[CreatureSaveService] Successfully uploaded all sprites for creature 8xpFsBbxUm37TXh1vHE6
[CreatureSaveService] Successfully saved creature 8xpFsBbxUm37TXh1vHE6
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2F8xpFsBbxUm37TXh1vHE6%2Fdirections%2FE-idle-0.png?alt=media
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2F8xpFsBbxUm37TXh1vHE6%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] Client connected: QJJUfhQ07Ru4N0RCAAAj
[Deployment Socket] player1 joining match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] Match d6ddb882-7737-452d-a7d4-1d0a0ec1455e not found, creating new match...
[Deployment Socket] Match d6ddb882-7737-452d-a7d4-1d0a0ec1455e created successfully
[Deployment Socket] player1 joined match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] player1 placed creature at (2, 3)
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: RPfWE_6oahmuXh9fAAAl
[Deployment Socket] player2 joining match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] player2 joined match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] player2 placed creature at (9, 3)
[Deployment Socket] player2 placed creature at (10, 5)
[Deployment Socket] player2 placed creature at (9, 0)
[Match d6ddb882-7737-452d-a7d4-1d0a0ec1455e] Countdown cancelled
[Match d6ddb882-7737-452d-a7d4-1d0a0ec1455e] Countdown started: 30 seconds
[Deployment Socket] player2 marked ready in match d6ddb882-7737-452d-a7d4-1d0a0ec1455e (3 creatures)
[Match d6ddb882-7737-452d-a7d4-1d0a0ec1455e] Countdown cancelled
[Match d6ddb882-7737-452d-a7d4-1d0a0ec1455e] Both players locked - deployment complete
[Match d6ddb882-7737-452d-a7d4-1d0a0ec1455e] Converting to deployment state:
  Player 1 placements: 1
  Player 2 placements: 3
[CombatEngine] initializeFromDeployment - Input: {
  matchId: 'd6ddb882-7737-452d-a7d4-1d0a0ec1455e',
  player1Placements: 1,
  player2Placements: 3
}
[CombatEngine] Created player1 unit: {
  unitId: 'player1_8xpFsBbxUm37TXh1vHE6_1760933898131',
  creatureId: '8xpFsBbxUm37TXh1vHE6',
  position: { q: 2, r: 3 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-rogue_1760933898132',
  creatureId: 'p2-rogue',
  position: { q: 9, r: 3 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-cleric_1760933898132',
  creatureId: 'p2-cleric',
  position: { q: 10, r: 5 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-tank_1760933898132',
  creatureId: 'p2-tank',
  position: { q: 9, r: 0 }
}
[CombatEngine] initializeFromDeployment - Units created: { totalUnits: 4, player1Units: 1, player2Units: 3 }
[CombatEngine] start() - Starting combat simulation: {
  matchId: 'd6ddb882-7737-452d-a7d4-1d0a0ec1455e',
  totalUnits: 4,
  player1Units: 1,
  player2Units: 3,
  tickRate: 60
}
[Deployment Socket] player1 marked ready in match d6ddb882-7737-452d-a7d4-1d0a0ec1455e (1 creatures)
[Combat Socket] ✓ Started broadcasting for match d6ddb882-7737-452d-a7d4-1d0a0ec1455e, 0 clients in room combat:d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Match d6ddb882-7737-452d-a7d4-1d0a0ec1455e] Combat socket broadcasting started
[Match d6ddb882-7737-452d-a7d4-1d0a0ec1455e] Combat started successfully
[CombatEngine] tick() - Tick 0 state: { totalUnits: 4, aliveUnits: 4, player1Alive: 1, player2Alive: 3 }
[Combat Socket] Client connected: JP_0fwhjkAg2eT0iAAAm
[Combat Socket] Client connected: myXuiuAweDOOKvl9AAAn
[Combat Socket] Client JP_0fwhjkAg2eT0iAAAm requesting to join match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Combat Socket] ✓ Client JP_0fwhjkAg2eT0iAAAm joined room combat:d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Combat Socket] Sending current combat state (tick 2) to JP_0fwhjkAg2eT0iAAAm
[Combat Socket] Emitting combat:joined to JP_0fwhjkAg2eT0iAAAm
[Combat Socket] Client myXuiuAweDOOKvl9AAAn requesting to join match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Combat Socket] ✓ Client myXuiuAweDOOKvl9AAAn joined room combat:d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Combat Socket] Sending current combat state (tick 2) to myXuiuAweDOOKvl9AAAn
[Combat Socket] Emitting combat:joined to myXuiuAweDOOKvl9AAAn
[Combat Socket] Broadcasting state tick 61 to 2 clients in room combat:d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Combat Socket] Broadcasting state tick 124 to 2 clients in room combat:d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Combat Socket] Broadcasting state tick 184 to 2 clients in room combat:d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[CombatEngine] checkVictoryCondition - Victory condition met: { tick: 189, player1Alive: 0, player2Alive: 3 }
[CombatEngine] endCombat - Combat ending: {
  matchId: 'd6ddb882-7737-452d-a7d4-1d0a0ec1455e',
  reason: 'elimination',
  winner: 'player2',
  tick: 189,
  player1Alive: 0,
  player2Alive: 3,
  totalUnits: 4
}
[Match d6ddb882-7737-452d-a7d4-1d0a0ec1455e] Combat completed - Winner: player2
[Combat Socket] No state found, stopping broadcast for match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Combat Socket] Stopped broadcasting for match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] player2 disconnected from match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] Client disconnected: z_DCT3e1NDszJCvHAAAV
[Combat Socket] Client disconnected: I_kSIQW8J_2eO4T7AAAW
[Deployment Socket] player2 disconnected from match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] Client disconnected: RPfWE_6oahmuXh9fAAAl
[Combat Socket] Client disconnected: JP_0fwhjkAg2eT0iAAAm
[Deployment Socket] player1 disconnected from match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] Client disconnected: QJJUfhQ07Ru4N0RCAAAj
[Combat Socket] Client disconnected: myXuiuAweDOOKvl9AAAn
[Deployment Socket] player2 disconnected from match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Deployment Socket] Client disconnected: oFNTRreernY00wUGAAAf
[Combat Socket] Client disconnected: Xsx8AEtdUoJ2K0gEAAAh
[Deployment Socket] Client connected: 8cQGE968YrR1PmRgAAAp
[Combat Socket] Client connected: cvvSajQ3uxzMmZ5tAAAq
[Deployment Socket] player2 joining match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] player2 joined match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] Client connected: CJo6veI4bAZWu7FVAAAs
[Combat Socket] Client connected: LlMbF2lDGhLhOBEcAAAt
[Deployment Socket] player2 joining match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Deployment Socket] player2 joined match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Deployment Socket] Client connected: 44K5tMFbVTjAqZruAAAv
[Combat Socket] Client connected: 0Y88rm_Aod3K0WKJAAAw
[Deployment Socket] player2 joining match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] player2 joined match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[Deployment Socket] Client connected: oUyQpu9OGsd1LvE6AAAy
[Deployment Socket] player1 joining match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] player1 joined match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2F8xpFsBbxUm37TXh1vHE6%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] player1 disconnected from match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] Client disconnected: oUyQpu9OGsd1LvE6AAAy
[Generate Enhanced] Received text request
[Generate Enhanced] Text description: a toaster
...
[Generate Enhanced] Submitting job to queue (text)
[Generate Enhanced] Job 26 submitted in 3ms
{"timestamp":"2025-10-20T04:19:59.132Z","level":"info","type":"queue_state_change","jobId":"26","fromState":"waiting","toState":"active","metadata":{"jobName":"generation","userId":"anonymous"}}
[Generation Processor] Processing job 26 (text)
[Generation Processor] Text-only path (PixelLab → Claude Vision)
[Generation Processor] Step 1: Generating sprite from text description...
[Generation Processor] PixelLab request: {
  description: 'a toaster\n',
  size: 64,
  detail: 'medium detail',
  shading: 'basic shading',
  outline: 'single color black outline',
  view: 'side',
  textGuidanceScale: 7.5,
  noBackground: true
}
[Generation Processor] PixelLab sprite generated, cost: 0 USD
[Generation Processor] Step 2: Analyzing generated sprite with Claude Vision...
[Claude Vision] Starting creature analysis...
[Claude Vision] Text context: "a toaster
"
The model 'claude-3-5-sonnet-20241022' is deprecated and will reach end-of-life on October 22, 2025
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.
[Claude Vision] Received response from API
[Claude Vision] Cost: $0.009579
[Claude Vision] Analysis complete
[Claude Vision] Concept: "metallic bread warmer"
[Claude Vision] Race: elemental, Class: support
[Claude Vision] Animations: 20
[Claude Vision] Tokens used: 1929
[Claude Vision] Duration: 4529ms
[Generation Processor] Step 3: Mapping animations from Claude analysis...
[Animation Mapper] Mapping animations...
[Animation Mapper] Claude suggested: 20 animations
[Animation Mapper] Mapped 8 from Claude suggestions
[Animation Mapper] Added 8 filler animations
[Animation Mapper] Total animations: 20
[Generation Processor] Step 4: Extracting combat attributes...
[Attribute Extractor] Extracting combat attributes...
[Attribute Extractor] Input abilities: 3
[Attribute Extractor] Found 3 unique attributes
[Attribute Extractor] 2 attributes have valid sprite animations
[Attribute Extractor] Selected 2 primary attributes:
  - Fire Spell (spell, priority: 8, animation: cast_fire_spell)
  - Buff (spell, priority: 5, animation: buff_spell)
[Attribute Extractor] Loading effect animation frames...
[Attribute Extractor] Loaded 4 frames for Buff
[Attribute Extractor] Loaded 4 frames for Fire Spell
[Generation Processor] Step 5: Generating walk animation frames...
[Generation Processor] Walk animation generated with 4 frames, cost: 0 USD
[Generation Processor] Step 6: Generating multi-directional battlefield views (rotation-based)...
[Generation Processor] Generating E direction using rotation API...
[Generation Processor] E sprite rotated, cost: 0.0000 USD
[Generation Processor] E walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] E idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Generating NE direction using rotation API...
[Generation Processor] NE sprite rotated, cost: 0.0000 USD
[Generation Processor] NE walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] NE idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Generating SE direction using rotation API...
[Generation Processor] SE sprite rotated, cost: 0.0000 USD
[Generation Processor] SE walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] SE idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Multi-directional battlefield views generation complete (rotation-based)
[Generation Processor] Total API cost: 0.0000 USD
[Generation Processor] Job 26 completed in 169248ms
{"timestamp":"2025-10-20T04:22:48.384Z","level":"info","type":"queue_state_change","jobId":"26","fromState":"active","toState":"completed","metadata":{"jobName":"generation...[truncated]","result":"[Object truncated]"}}
[Creatures API] Saving creature from job 26 for owner demo-player1
[CreatureSaveService] Starting save for job 26, owner demo-player1
[CreatureSaveService] Retrieved generation result for job 26
[CreatureSaveService] Transformed to creature: Metallic Bread Warmer
[CreatureSaveService] Created Firestore document with ID: CZ6Kd4zQZ9bzNnkvrWMx
[CreatureSaveService] Uploading sprites for creature CZ6Kd4zQZ9bzNnkvrWMx...
[CreatureSaveService] Using multi-directional battlefield views
[CreatureSaveService] Successfully uploaded all sprites for creature CZ6Kd4zQZ9bzNnkvrWMx
[CreatureSaveService] Successfully saved creature CZ6Kd4zQZ9bzNnkvrWMx
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FCZ6Kd4zQZ9bzNnkvrWMx%2Fdirections%2FE-idle-0.png?alt=media
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FCZ6Kd4zQZ9bzNnkvrWMx%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] Client connected: hGRjOxuTmg2p7M0_AAA0
[Deployment Socket] player1 joining match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] Match f1414461-3dd8-41f1-9a1b-7b17922dbded not found, creating new match...
[Deployment Socket] Match f1414461-3dd8-41f1-9a1b-7b17922dbded created successfully
[Deployment Socket] player1 joined match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] player1 placed creature at (2, 4)
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: Uyj9tYi0iQQMY53kAAA2
[Deployment Socket] player2 joining match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] player2 joined match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] player2 placed creature at (9, 4)
[Deployment Socket] player2 placed creature at (9, 1)
[Match f1414461-3dd8-41f1-9a1b-7b17922dbded] Countdown cancelled
[Match f1414461-3dd8-41f1-9a1b-7b17922dbded] Countdown started: 30 seconds
[Deployment Socket] player2 marked ready in match f1414461-3dd8-41f1-9a1b-7b17922dbded (2 creatures)
[Match f1414461-3dd8-41f1-9a1b-7b17922dbded] Countdown cancelled
[Match f1414461-3dd8-41f1-9a1b-7b17922dbded] Both players locked - deployment complete
[Match f1414461-3dd8-41f1-9a1b-7b17922dbded] Converting to deployment state:
  Player 1 placements: 1
  Player 2 placements: 2
[CombatEngine] initializeFromDeployment - Input: {
  matchId: 'f1414461-3dd8-41f1-9a1b-7b17922dbded',
  player1Placements: 1,
  player2Placements: 2
}
[CombatEngine] Created player1 unit: {
  unitId: 'player1_CZ6Kd4zQZ9bzNnkvrWMx_1760934189387',
  creatureId: 'CZ6Kd4zQZ9bzNnkvrWMx',
  position: { q: 2, r: 4 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-mage_1760934189388',
  creatureId: 'p2-mage',
  position: { q: 9, r: 4 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-tank_1760934189388',
  creatureId: 'p2-tank',
  position: { q: 9, r: 1 }
}
[CombatEngine] initializeFromDeployment - Units created: { totalUnits: 3, player1Units: 1, player2Units: 2 }
[CombatEngine] start() - Starting combat simulation: {
  matchId: 'f1414461-3dd8-41f1-9a1b-7b17922dbded',
  totalUnits: 3,
  player1Units: 1,
  player2Units: 2,
  tickRate: 60
}
[Deployment Socket] player1 marked ready in match f1414461-3dd8-41f1-9a1b-7b17922dbded (1 creatures)
[Combat Socket] ✓ Started broadcasting for match f1414461-3dd8-41f1-9a1b-7b17922dbded, 0 clients in room combat:f1414461-3dd8-41f1-9a1b-7b17922dbded
[Match f1414461-3dd8-41f1-9a1b-7b17922dbded] Combat socket broadcasting started
[Match f1414461-3dd8-41f1-9a1b-7b17922dbded] Combat started successfully
[CombatEngine] tick() - Tick 0 state: { totalUnits: 3, aliveUnits: 3, player1Alive: 1, player2Alive: 2 }
[Combat Socket] Client connected: -Gxpm8nCMvAHLSZGAAA3
[Combat Socket] Client connected: C4uODPTNgHwEsHNgAAA4
[Combat Socket] Client -Gxpm8nCMvAHLSZGAAA3 requesting to join match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Combat Socket] ✓ Client -Gxpm8nCMvAHLSZGAAA3 joined room combat:f1414461-3dd8-41f1-9a1b-7b17922dbded
[Combat Socket] Sending current combat state (tick 2) to -Gxpm8nCMvAHLSZGAAA3
[Combat Socket] Emitting combat:joined to -Gxpm8nCMvAHLSZGAAA3
[Combat Socket] Client C4uODPTNgHwEsHNgAAA4 requesting to join match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Combat Socket] ✓ Client C4uODPTNgHwEsHNgAAA4 joined room combat:f1414461-3dd8-41f1-9a1b-7b17922dbded
[Combat Socket] Sending current combat state (tick 2) to C4uODPTNgHwEsHNgAAA4
[Combat Socket] Emitting combat:joined to C4uODPTNgHwEsHNgAAA4
[Combat Socket] Broadcasting state tick 61 to 2 clients in room combat:f1414461-3dd8-41f1-9a1b-7b17922dbded
[Combat Socket] Broadcasting state tick 123 to 2 clients in room combat:f1414461-3dd8-41f1-9a1b-7b17922dbded
[Combat Socket] Broadcasting state tick 184 to 2 clients in room combat:f1414461-3dd8-41f1-9a1b-7b17922dbded
[Combat Socket] Broadcasting state tick 245 to 2 clients in room combat:f1414461-3dd8-41f1-9a1b-7b17922dbded
[CombatEngine] checkVictoryCondition - Victory condition met: { tick: 251, player1Alive: 0, player2Alive: 2 }
[CombatEngine] endCombat - Combat ending: {
  matchId: 'f1414461-3dd8-41f1-9a1b-7b17922dbded',
  reason: 'elimination',
  winner: 'player2',
  tick: 251,
  player1Alive: 0,
  player2Alive: 2,
  totalUnits: 3
}
[Match f1414461-3dd8-41f1-9a1b-7b17922dbded] Combat completed - Winner: player2
[Combat Socket] No state found, stopping broadcast for match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Combat Socket] Stopped broadcasting for match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] player2 disconnected from match 5445e307-0e68-4ed1-b01d-47e49caf0384
[Deployment Socket] Client disconnected: 8cQGE968YrR1PmRgAAAp
[Combat Socket] Client disconnected: cvvSajQ3uxzMmZ5tAAAq
[Deployment Socket] player2 disconnected from match 648c032e-2fe9-42cd-8154-97ca411a9ce6
[Deployment Socket] Client disconnected: CJo6veI4bAZWu7FVAAAs
[Combat Socket] Client disconnected: LlMbF2lDGhLhOBEcAAAt
[Deployment Socket] player2 disconnected from match d6ddb882-7737-452d-a7d4-1d0a0ec1455e
[Deployment Socket] Client disconnected: 44K5tMFbVTjAqZruAAAv
[Combat Socket] Client disconnected: 0Y88rm_Aod3K0WKJAAAw
[Deployment Socket] player2 disconnected from match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] Client disconnected: Uyj9tYi0iQQMY53kAAA2
[Combat Socket] Client disconnected: C4uODPTNgHwEsHNgAAA4
[Deployment Socket] player1 disconnected from match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] Client disconnected: hGRjOxuTmg2p7M0_AAA0
[Combat Socket] Client disconnected: -Gxpm8nCMvAHLSZGAAA3
[Deployment Socket] Client connected: aTB8IJbogmXU5IlGAAA6
[Combat Socket] Client connected: si1V98V6Q1Raj0Y2AAA7
[Deployment Socket] player1 joining match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] player1 joined match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] player1 disconnected from match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] Client disconnected: aTB8IJbogmXU5IlGAAA6
[Combat Socket] Client disconnected: si1V98V6Q1Raj0Y2AAA7
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[Deployment Socket] Client connected: jo0f_ErX7FEo0370AAA9
[Deployment Socket] player1 joining match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] player1 joined match f1414461-3dd8-41f1-9a1b-7b17922dbded
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FCZ6Kd4zQZ9bzNnkvrWMx%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] player1 disconnected from match f1414461-3dd8-41f1-9a1b-7b17922dbded
[Deployment Socket] Client disconnected: jo0f_ErX7FEo0370AAA9
[Generate Enhanced] Received text request
[Generate Enhanced] Text description: a wizard with a green robe and who slings pizza...
[Generate Enhanced] Submitting job to queue (text)
[Generate Enhanced] Job 27 submitted in 2ms
{"timestamp":"2025-10-20T13:33:30.608Z","level":"info","type":"queue_state_change","jobId":"27","fromState":"waiting","toState":"active","metadata":{"jobName":"generation","userId":"anonymous"}}
[Generation Processor] Processing job 27 (text)
[Generation Processor] Text-only path (PixelLab → Claude Vision)
[Generation Processor] Step 1: Generating sprite from text description...
[Generation Processor] PixelLab request: {
  description: 'a wizard with a green robe and who slings pizza',
  size: 64,
  detail: 'medium detail',
  shading: 'basic shading',
  outline: 'single color black outline',
  view: 'side',
  textGuidanceScale: 7.5,
  noBackground: true
}
[Generation Processor] PixelLab sprite generated, cost: 0 USD
[Generation Processor] Step 2: Analyzing generated sprite with Claude Vision...
[Claude Vision] Starting creature analysis...
[Claude Vision] Text context: "a wizard with a green robe and who slings pizza"
The model 'claude-3-5-sonnet-20241022' is deprecated and will reach end-of-life on October 22, 2025
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.
[Claude Vision] Received response from API
[Claude Vision] Cost: $0.009903
[Claude Vision] Analysis complete
[Claude Vision] Concept: "pizza wizard gnome"
[Claude Vision] Race: gnome, Class: mage
[Claude Vision] Animations: 25
[Claude Vision] Tokens used: 1957
[Claude Vision] Duration: 5003ms
[Generation Processor] Step 3: Mapping animations from Claude analysis...
[Animation Mapper] Mapping animations...
[Animation Mapper] Claude suggested: 25 animations
[Animation Mapper] Mapped 15 from Claude suggestions
[Animation Mapper] Added 3 filler animations
[Animation Mapper] Total animations: 22
[Generation Processor] Step 4: Extracting combat attributes...
[Attribute Extractor] Extracting combat attributes...
[Attribute Extractor] Input abilities: 4
[Attribute Extractor] Found 4 unique attributes
[Attribute Extractor] 2 attributes have valid sprite animations
[Attribute Extractor] Selected 2 primary attributes:
  - Teleport (spell, priority: 6, animation: teleport)
  - Heal (spell, priority: 6, animation: heal_spell)
[Attribute Extractor] Loading effect animation frames...
[Attribute Extractor] Loaded 4 frames for Heal
[Attribute Extractor] Loaded 4 frames for Teleport
[Generation Processor] Step 5: Generating walk animation frames...
[Generation Processor] Walk animation generated with 4 frames, cost: 0 USD
[Generation Processor] Step 6: Generating multi-directional battlefield views (rotation-based)...
[Generation Processor] Generating E direction using rotation API...
[Generation Processor] E sprite rotated, cost: 0.0000 USD
[Generation Processor] E walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] E idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Generating NE direction using rotation API...
[Generation Processor] NE sprite rotated, cost: 0.0000 USD
[Generation Processor] NE walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] NE idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Generating SE direction using rotation API...
[Generation Processor] SE sprite rotated, cost: 0.0000 USD
[Generation Processor] SE walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] SE idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Multi-directional battlefield views generation complete (rotation-based)
[Generation Processor] Total API cost: 0.0000 USD
[Generation Processor] Job 27 completed in 167337ms
{"timestamp":"2025-10-20T13:36:17.950Z","level":"info","type":"queue_state_change","jobId":"27","fromState":"active","toState":"completed","metadata":{"jobName":"generation...[truncated]","result":"[Object truncated]"}}
[Creatures API] Saving creature from job 27 for owner demo-player1
[CreatureSaveService] Starting save for job 27, owner demo-player1
[CreatureSaveService] Retrieved generation result for job 27
[CreatureSaveService] Transformed to creature: Pizza Wizard Gnome
[CreatureSaveService] Created Firestore document with ID: EeospI6G2AaOl6QstNvq
[CreatureSaveService] Uploading sprites for creature EeospI6G2AaOl6QstNvq...
[CreatureSaveService] Using multi-directional battlefield views
[CreatureSaveService] Successfully uploaded all sprites for creature EeospI6G2AaOl6QstNvq
[CreatureSaveService] Successfully saved creature EeospI6G2AaOl6QstNvq
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FEeospI6G2AaOl6QstNvq%2Fdirections%2FE-idle-0.png?alt=media
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FEeospI6G2AaOl6QstNvq%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] Client connected: Mre1Z1Cmjmw6szDdAAA_
[Deployment Socket] player1 joining match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] Match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a not found, creating new match...
[Deployment Socket] Match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a created successfully
[Deployment Socket] player1 joined match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player1 placed creature at (2, 3)
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: 0AZqyV31407in2sxAABB
[Deployment Socket] player2 joining match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player2 joined match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player2 placed creature at (9, 3)
[Match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a] Countdown cancelled
[Match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a] Countdown started: 30 seconds
[Deployment Socket] player2 marked ready in match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a (1 creatures)
[Match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a] Countdown cancelled
[Match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a] Both players locked - deployment complete
[Match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a] Converting to deployment state:
  Player 1 placements: 1
  Player 2 placements: 1
[CombatEngine] initializeFromDeployment - Input: {
  matchId: 'e44b8f25-7b03-49fe-aa0d-46b9fa5e514a',
  player1Placements: 1,
  player2Placements: 1
}
[CombatEngine] Created player1 unit: {
  unitId: 'player1_EeospI6G2AaOl6QstNvq_1760967405616',
  creatureId: 'EeospI6G2AaOl6QstNvq',
  position: { q: 2, r: 3 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-warrior_1760967405616',
  creatureId: 'p2-warrior',
  position: { q: 9, r: 3 }
}
[CombatEngine] initializeFromDeployment - Units created: { totalUnits: 2, player1Units: 1, player2Units: 1 }
[CombatEngine] start() - Starting combat simulation: {
  matchId: 'e44b8f25-7b03-49fe-aa0d-46b9fa5e514a',
  totalUnits: 2,
  player1Units: 1,
  player2Units: 1,
  tickRate: 60
}
[Deployment Socket] player1 marked ready in match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a (1 creatures)
[Combat Socket] ✓ Started broadcasting for match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a, 0 clients in room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a] Combat socket broadcasting started
[Match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a] Combat started successfully
[CombatEngine] tick() - Tick 0 state: { totalUnits: 2, aliveUnits: 2, player1Alive: 1, player2Alive: 1 }
[Combat Socket] Client connected: JAjKzIJyCjjI3zHlAABC
[Combat Socket] Client connected: jGDsN6auel5iVaXJAABD
[Combat Socket] Client JAjKzIJyCjjI3zHlAABC requesting to join match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] ✓ Client JAjKzIJyCjjI3zHlAABC joined room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Sending current combat state (tick 2) to JAjKzIJyCjjI3zHlAABC
[Combat Socket] Emitting combat:joined to JAjKzIJyCjjI3zHlAABC
[Combat Socket] Client jGDsN6auel5iVaXJAABD requesting to join match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] ✓ Client jGDsN6auel5iVaXJAABD joined room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Sending current combat state (tick 2) to jGDsN6auel5iVaXJAABD
[Combat Socket] Emitting combat:joined to jGDsN6auel5iVaXJAABD
[Combat Socket] Broadcasting state tick 61 to 2 clients in room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Broadcasting state tick 122 to 2 clients in room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Broadcasting state tick 184 to 2 clients in room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Broadcasting state tick 245 to 2 clients in room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Broadcasting state tick 306 to 2 clients in room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Broadcasting state tick 368 to 2 clients in room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Broadcasting state tick 429 to 2 clients in room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Broadcasting state tick 491 to 2 clients in room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Broadcasting state tick 552 to 2 clients in room combat:e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[CombatEngine] checkVictoryCondition - Victory condition met: { tick: 556, player1Alive: 1, player2Alive: 0 }
[CombatEngine] endCombat - Combat ending: {
  matchId: 'e44b8f25-7b03-49fe-aa0d-46b9fa5e514a',
  reason: 'elimination',
  winner: 'player1',
  tick: 556,
  player1Alive: 1,
  player2Alive: 0,
  totalUnits: 2
}
[Match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a] Combat completed - Winner: player1
[Combat Socket] No state found, stopping broadcast for match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Combat Socket] Stopped broadcasting for match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player2 disconnected from match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] Client disconnected: 0AZqyV31407in2sxAABB
[Combat Socket] Client disconnected: jGDsN6auel5iVaXJAABD
[Deployment Socket] player1 disconnected from match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] Client disconnected: Mre1Z1Cmjmw6szDdAAA_
[Combat Socket] Client disconnected: JAjKzIJyCjjI3zHlAABC
[Deployment Socket] Client connected: FDN5YcXxGcE857mXAABG
[Combat Socket] Client connected: Mbmd23B3K60z2eikAABH
[Deployment Socket] Client connected: X-ai8WmbX91mkmQ8AABI
[Combat Socket] Client connected: mhiE5GJ4UzR-BRZrAABJ
[Deployment Socket] player1 joining match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player1 joined match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player2 joining match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player2 joined match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player1 disconnected from match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] Client disconnected: FDN5YcXxGcE857mXAABG
[Combat Socket] Client disconnected: Mbmd23B3K60z2eikAABH
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[Deployment Socket] Client connected: fbTbCbfwOkfoY2NyAABL
[Deployment Socket] player1 joining match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player1 joined match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FEeospI6G2AaOl6QstNvq%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] player1 disconnected from match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] Client disconnected: fbTbCbfwOkfoY2NyAABL
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FEeospI6G2AaOl6QstNvq%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] Client connected: xaWc49dZq9om4jkQAABN
[Deployment Socket] player1 joining match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player1 joined match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player2 disconnected from match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] Client disconnected: X-ai8WmbX91mkmQ8AABI
[Combat Socket] Client disconnected: mhiE5GJ4UzR-BRZrAABJ
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: HeAdT29klZtkHyaBAABP
[Deployment Socket] player2 joining match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player2 joined match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] player2 disconnected from match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] Client disconnected: HeAdT29klZtkHyaBAABP
[Deployment Socket] player1 disconnected from match e44b8f25-7b03-49fe-aa0d-46b9fa5e514a
[Deployment Socket] Client disconnected: xaWc49dZq9om4jkQAABN
[Generate Enhanced] Received text request
[Generate Enhanced] Text description: A knight with a rainbow sparkle sword ...
[Generate Enhanced] Submitting job to queue (text)
[Generate Enhanced] Job 28 submitted in 20ms
{"timestamp":"2025-10-20T22:05:10.956Z","level":"info","type":"queue_state_change","jobId":"28","fromState":"waiting","toState":"active","metadata":{"jobName":"generation","userId":"anonymous"}}
[Generation Processor] Processing job 28 (text)
[Generation Processor] Text-only path (PixelLab → Claude Vision)
[Generation Processor] Step 1: Generating sprite from text description...
[Generation Processor] PixelLab request: {
  description: 'A knight with a rainbow sparkle sword ',
  size: 64,
  detail: 'medium detail',
  shading: 'basic shading',
  outline: 'single color black outline',
  view: 'side',
  textGuidanceScale: 7.5,
  noBackground: true
}
[Generation Processor] PixelLab sprite generated, cost: 0 USD
[Generation Processor] Step 2: Analyzing generated sprite with Claude Vision...
[Claude Vision] Starting creature analysis...
[Claude Vision] Text context: "A knight with a rainbow sparkle sword "
The model 'claude-3-5-sonnet-20241022' is deprecated and will reach end-of-life on October 22, 2025
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.
[Claude Vision] Received response from API
[Claude Vision] Cost: $0.009531
[Claude Vision] Analysis complete
[Claude Vision] Concept: "sparkle knight warrior"
[Claude Vision] Race: magical knight, Class: knight
[Claude Vision] Animations: 20
[Claude Vision] Tokens used: 1929
[Claude Vision] Duration: 5785ms
[Generation Processor] Step 3: Mapping animations from Claude analysis...
[Animation Mapper] Mapping animations...
[Animation Mapper] Claude suggested: 20 animations
[Animation Mapper] Mapped 11 from Claude suggestions
[Animation Mapper] Added 5 filler animations
[Animation Mapper] Total animations: 20
[Generation Processor] Step 4: Extracting combat attributes...
[Attribute Extractor] Extracting combat attributes...
[Attribute Extractor] Input abilities: 4
[Attribute Extractor] Found 4 unique attributes
[Attribute Extractor] 2 attributes have valid sprite animations
[Attribute Extractor] Selected 2 primary attributes:
  - Sword Strike (melee, priority: 6, animation: attack_melee_sword)
  - Parry (defense, priority: 5, animation: parry_default)
[Attribute Extractor] Loading effect animation frames...
[Attribute Extractor] Loaded 4 frames for Sword Strike
[Attribute Extractor] Loaded 4 frames for Parry
[Generation Processor] Step 5: Generating walk animation frames...
[Generation Processor] Walk animation generated with 4 frames, cost: 0 USD
[Generation Processor] Step 6: Generating multi-directional battlefield views (rotation-based)...
[Generation Processor] Generating E direction using rotation API...
[Generation Processor] E sprite rotated, cost: 0.0000 USD
[Generation Processor] E walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] E idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Generating NE direction using rotation API...
[Generation Processor] NE sprite rotated, cost: 0.0000 USD
[Generation Processor] NE walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] NE idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Generating SE direction using rotation API...
[Generation Processor] SE sprite rotated, cost: 0.0000 USD
[Generation Processor] SE walk animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] SE idle animation generated with 4 frames, cost: 0.0000 USD
[Generation Processor] Multi-directional battlefield views generation complete (rotation-based)
[Generation Processor] Total API cost: 0.0000 USD
[Generation Processor] Job 28 completed in 168144ms
{"timestamp":"2025-10-20T22:07:59.107Z","level":"info","type":"queue_state_change","jobId":"28","fromState":"active","toState":"completed","metadata":{"jobName":"generation...[truncated]","result":"[Object truncated]"}}
[Creatures API] Saving creature from job 28 for owner demo-player1
[CreatureSaveService] Starting save for job 28, owner demo-player1
[CreatureSaveService] Retrieved generation result for job 28
[CreatureSaveService] Transformed to creature: Sparkle Knight Warrior
[CreatureSaveService] Created Firestore document with ID: 8O0oUopTCmZz43QmXruq
[CreatureSaveService] Uploading sprites for creature 8O0oUopTCmZz43QmXruq...
[CreatureSaveService] Using multi-directional battlefield views
[CreatureSaveService] Successfully uploaded all sprites for creature 8O0oUopTCmZz43QmXruq
[CreatureSaveService] Successfully saved creature 8O0oUopTCmZz43QmXruq
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2F8O0oUopTCmZz43QmXruq%2Fdirections%2FE-idle-0.png?alt=media
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2F8O0oUopTCmZz43QmXruq%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] Client connected: ldlFKgdphErzcVtjAABR
[Deployment Socket] player1 joining match 3c06218d-2882-4092-a2ac-12ce651552ca
[Deployment Socket] Match 3c06218d-2882-4092-a2ac-12ce651552ca not found, creating new match...
[Deployment Socket] Match 3c06218d-2882-4092-a2ac-12ce651552ca created successfully
[Deployment Socket] player1 joined match 3c06218d-2882-4092-a2ac-12ce651552ca
[Deployment Socket] player1 placed creature at (2, 3)
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: _Q6SC2ADasH0hHAuAABT
[Deployment Socket] player2 joining match 3c06218d-2882-4092-a2ac-12ce651552ca
[Deployment Socket] player2 joined match 3c06218d-2882-4092-a2ac-12ce651552ca
[Deployment Socket] player2 placed creature at (9, 3)
[Match 3c06218d-2882-4092-a2ac-12ce651552ca] Countdown cancelled
[Match 3c06218d-2882-4092-a2ac-12ce651552ca] Countdown started: 30 seconds
[Deployment Socket] player2 marked ready in match 3c06218d-2882-4092-a2ac-12ce651552ca (1 creatures)
[Match 3c06218d-2882-4092-a2ac-12ce651552ca] Countdown cancelled
[Match 3c06218d-2882-4092-a2ac-12ce651552ca] Both players locked - deployment complete
[Match 3c06218d-2882-4092-a2ac-12ce651552ca] Converting to deployment state:
  Player 1 placements: 1
  Player 2 placements: 1
[CombatEngine] initializeFromDeployment - Input: {
  matchId: '3c06218d-2882-4092-a2ac-12ce651552ca',
  player1Placements: 1,
  player2Placements: 1
}
[CombatEngine] Created player1 unit: {
  unitId: 'player1_8O0oUopTCmZz43QmXruq_1761001376121',
  creatureId: '8O0oUopTCmZz43QmXruq',
  position: { q: 2, r: 3 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-archer_1761001376121',
  creatureId: 'p2-archer',
  position: { q: 9, r: 3 }
}
[CombatEngine] initializeFromDeployment - Units created: { totalUnits: 2, player1Units: 1, player2Units: 1 }
[CombatEngine] start() - Starting combat simulation: {
  matchId: '3c06218d-2882-4092-a2ac-12ce651552ca',
  totalUnits: 2,
  player1Units: 1,
  player2Units: 1,
  tickRate: 60
}
[Deployment Socket] player1 marked ready in match 3c06218d-2882-4092-a2ac-12ce651552ca (1 creatures)
[Combat Socket] ✓ Started broadcasting for match 3c06218d-2882-4092-a2ac-12ce651552ca, 0 clients in room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Match 3c06218d-2882-4092-a2ac-12ce651552ca] Combat socket broadcasting started
[Match 3c06218d-2882-4092-a2ac-12ce651552ca] Combat started successfully
[CombatEngine] tick() - Tick 0 state: { totalUnits: 2, aliveUnits: 2, player1Alive: 1, player2Alive: 1 }
[Combat Socket] Client connected: zSCUXv9n2ZAnIgMDAABU
[Combat Socket] Client connected: xlOLxdxYGiuUa86bAABV
[Combat Socket] Client zSCUXv9n2ZAnIgMDAABU requesting to join match 3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] ✓ Client zSCUXv9n2ZAnIgMDAABU joined room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Sending current combat state (tick 3) to zSCUXv9n2ZAnIgMDAABU
[Combat Socket] Emitting combat:joined to zSCUXv9n2ZAnIgMDAABU
[Combat Socket] Client xlOLxdxYGiuUa86bAABV requesting to join match 3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] ✓ Client xlOLxdxYGiuUa86bAABV joined room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Sending current combat state (tick 3) to xlOLxdxYGiuUa86bAABV
[Combat Socket] Emitting combat:joined to xlOLxdxYGiuUa86bAABV
[Combat Socket] Broadcasting state tick 62 to 2 clients in room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Broadcasting state tick 124 to 2 clients in room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Broadcasting state tick 185 to 2 clients in room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Broadcasting state tick 247 to 2 clients in room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Broadcasting state tick 309 to 2 clients in room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Broadcasting state tick 371 to 2 clients in room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Broadcasting state tick 433 to 2 clients in room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Broadcasting state tick 495 to 2 clients in room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Broadcasting state tick 557 to 2 clients in room combat:3c06218d-2882-4092-a2ac-12ce651552ca
[CombatEngine] checkVictoryCondition - Victory condition met: { tick: 616, player1Alive: 0, player2Alive: 1 }
[CombatEngine] endCombat - Combat ending: {
  matchId: '3c06218d-2882-4092-a2ac-12ce651552ca',
  reason: 'elimination',
  winner: 'player2',
  tick: 616,
  player1Alive: 0,
  player2Alive: 1,
  totalUnits: 2
}
[Match 3c06218d-2882-4092-a2ac-12ce651552ca] Combat completed - Winner: player2
[Combat Socket] No state found, stopping broadcast for match 3c06218d-2882-4092-a2ac-12ce651552ca
[Combat Socket] Stopped broadcasting for match 3c06218d-2882-4092-a2ac-12ce651552ca
[Deployment Socket] player2 disconnected from match 3c06218d-2882-4092-a2ac-12ce651552ca
[Deployment Socket] Client disconnected: _Q6SC2ADasH0hHAuAABT
[Combat Socket] Client disconnected: xlOLxdxYGiuUa86bAABV
[Deployment Socket] player1 disconnected from match 3c06218d-2882-4092-a2ac-12ce651552ca
[Deployment Socket] Client disconnected: ldlFKgdphErzcVtjAABR
[Combat Socket] Client disconnected: zSCUXv9n2ZAnIgMDAABU
[Creatures API] Saving creature from job 28 for owner demo-player1
[CreatureSaveService] Starting save for job 28, owner demo-player1
[CreatureSaveService] Retrieved generation result for job 28
[CreatureSaveService] Transformed to creature: Sparkle Knight Warrior
[CreatureSaveService] Created Firestore document with ID: YK6d2qRk60PMb3Nd6Rsr
[CreatureSaveService] Uploading sprites for creature YK6d2qRk60PMb3Nd6Rsr...
[CreatureSaveService] Using multi-directional battlefield views
[CreatureSaveService] Successfully uploaded all sprites for creature YK6d2qRk60PMb3Nd6Rsr
[CreatureSaveService] Successfully saved creature YK6d2qRk60PMb3Nd6Rsr
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FYK6d2qRk60PMb3Nd6Rsr%2Fdirections%2FE-idle-0.png?alt=media
[Creatures API] Batch fetching 1 creatures for owner demo-player1
[URL Converter] Converting creature URLs
[URL Converter] E idleFrames count: 4
[URL Converter] NE idleFrames count: 4
[URL Converter] SE idleFrames count: 4
[URL Converter] Conversion complete
[URL Converter] Result E idleFrames count: 4
[URL Converter] Sample E idle frame URL: http://localhost:9199/v0/b/drawn-of-war.appspot.com/o/creatures%2FYK6d2qRk60PMb3Nd6Rsr%2Fdirections%2FE-idle-0.png?alt=media
[Deployment Socket] Client connected: FoRxTxtCIxEwMF4TAABX
[Deployment Socket] player1 joining match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Deployment Socket] Match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d not found, creating new match...
[Deployment Socket] Match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d created successfully
[Deployment Socket] player1 joined match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Deployment Socket] player1 placed creature at (2, 7)
[CreatureSpriteManager] Returning cached sprite for p1-warrior
[CreatureSpriteManager] Returning cached sprite for p1-archer
[CreatureSpriteManager] Returning cached sprite for p1-mage
[CreatureSpriteManager] Returning cached sprite for p1-tank
[CreatureSpriteManager] Returning cached sprite for p1-rogue
[CreatureSpriteManager] Returning cached sprite for p1-cleric
[CreatureSpriteManager] Returning cached sprite for p1-paladin
[CreatureSpriteManager] Returning cached sprite for p1-ranger
[CreatureSpriteManager] Returning cached sprite for p2-warrior
[CreatureSpriteManager] Returning cached sprite for p2-archer
[CreatureSpriteManager] Returning cached sprite for p2-mage
[CreatureSpriteManager] Returning cached sprite for p2-tank
[CreatureSpriteManager] Returning cached sprite for p2-rogue
[CreatureSpriteManager] Returning cached sprite for p2-cleric
[CreatureSpriteManager] Returning cached sprite for p2-paladin
[CreatureSpriteManager] Returning cached sprite for p2-ranger
[Deployment Socket] Client connected: QHev5ph9cDBE3IczAABZ
[Deployment Socket] player2 joining match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Deployment Socket] player2 joined match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Deployment Socket] player2 placed creature at (9, 3)
[Match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d] Countdown cancelled
[Match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d] Countdown started: 30 seconds
[Deployment Socket] player2 marked ready in match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d (1 creatures)
[Match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d] Countdown cancelled
[Match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d] Both players locked - deployment complete
[Match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d] Converting to deployment state:
  Player 1 placements: 1
  Player 2 placements: 1
[CombatEngine] initializeFromDeployment - Input: {
  matchId: '05ad782a-c9e8-4ce5-97fb-de2b1799b72d',
  player1Placements: 1,
  player2Placements: 1
}
[CombatEngine] Created player1 unit: {
  unitId: 'player1_YK6d2qRk60PMb3Nd6Rsr_1761001818280',
  creatureId: 'YK6d2qRk60PMb3Nd6Rsr',
  position: { q: 2, r: 7 }
}
[CombatEngine] Created player2 unit: {
  unitId: 'player2_p2-mage_1761001818280',
  creatureId: 'p2-mage',
  position: { q: 9, r: 3 }
}
[CombatEngine] initializeFromDeployment - Units created: { totalUnits: 2, player1Units: 1, player2Units: 1 }
[CombatEngine] start() - Starting combat simulation: {
  matchId: '05ad782a-c9e8-4ce5-97fb-de2b1799b72d',
  totalUnits: 2,
  player1Units: 1,
  player2Units: 1,
  tickRate: 60
}
[Deployment Socket] player1 marked ready in match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d (1 creatures)
[Combat Socket] ✓ Started broadcasting for match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d, 0 clients in room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d] Combat socket broadcasting started
[Match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d] Combat started successfully
[CombatEngine] tick() - Tick 0 state: { totalUnits: 2, aliveUnits: 2, player1Alive: 1, player2Alive: 1 }
[Combat Socket] Client connected: HJs6ywYgNnZw-YqkAABa
[Combat Socket] Client connected: 25SvhIKcKqqFgX2hAABb
[Combat Socket] Client HJs6ywYgNnZw-YqkAABa requesting to join match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] ✓ Client HJs6ywYgNnZw-YqkAABa joined room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] Sending current combat state (tick 2) to HJs6ywYgNnZw-YqkAABa
[Combat Socket] Emitting combat:joined to HJs6ywYgNnZw-YqkAABa
[Combat Socket] Client 25SvhIKcKqqFgX2hAABb requesting to join match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] ✓ Client 25SvhIKcKqqFgX2hAABb joined room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] Sending current combat state (tick 2) to 25SvhIKcKqqFgX2hAABb
[Combat Socket] Emitting combat:joined to 25SvhIKcKqqFgX2hAABb
[Combat Socket] Broadcasting state tick 61 to 2 clients in room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] Broadcasting state tick 123 to 2 clients in room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] Broadcasting state tick 185 to 2 clients in room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] Broadcasting state tick 247 to 2 clients in room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] Broadcasting state tick 309 to 2 clients in room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] Broadcasting state tick 371 to 2 clients in room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] Broadcasting state tick 433 to 2 clients in room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] Broadcasting state tick 495 to 2 clients in room combat:05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[CombatEngine] checkVictoryCondition - Victory condition met: { tick: 556, player1Alive: 1, player2Alive: 0 }
[CombatEngine] endCombat - Combat ending: {
  matchId: '05ad782a-c9e8-4ce5-97fb-de2b1799b72d',
  reason: 'elimination',
  winner: 'player1',
  tick: 556,
  player1Alive: 1,
  player2Alive: 0,
  totalUnits: 2
}
[Match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d] Combat completed - Winner: player1
[Combat Socket] No state found, stopping broadcast for match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Combat Socket] Stopped broadcasting for match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Deployment Socket] player2 disconnected from match 05ad782a-c9e8-4ce5-97fb-de2b1799b72d
[Deployment Socket] Client disconnected: QHev5ph9cDBE3IczAABZ
[Combat Socket] Client disconnected: 25SvhIKcKqqFgX2hAABb
